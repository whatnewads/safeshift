# Apache Virtual Host Configuration for SafeShift Docker Container
# Document root points to server/public/ directory

# HTTP Virtual Host (Port 80)
<VirtualHost *:80>
    DocumentRoot "/var/www/html/public"
    ServerName localhost
    ServerAlias 127.0.0.1

    # Error and Access Logs
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # Directory Configuration for public directory
    <Directory "/var/www/html/public">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # Enable URL rewriting for router.php
        RewriteEngine On
        
        # If the request is for a real file or directory, serve it directly
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        
        # Route all other requests through router.php
        RewriteRule ^(.*)$ router.php [QSA,L]
    </Directory>

    # Deny access to sensitive directories
    <Directory "/var/www/html/model">
        Require all denied
    </Directory>

    <Directory "/var/www/html/ViewModel">
        Require all denied
    </Directory>

    <Directory "/var/www/html/logs">
        Require all denied
    </Directory>

    <Directory "/var/www/html/sessions">
        Require all denied
    </Directory>

    <Directory "/var/www/html/cache">
        Require all denied
    </Directory>

    # API directory configuration
    <Directory "/var/www/html/api">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>

# HTTPS Virtual Host (Port 443) - Optional, uncomment and configure SSL certs if needed
# <VirtualHost *:443>
#     DocumentRoot "/var/www/html/public"
#     ServerName localhost
#     ServerAlias 127.0.0.1
#     ServerAdmin admin@localhost
#     
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile "/etc/ssl/certs/ssl-cert-snakeoil.pem"
#     SSLCertificateKeyFile "/etc/ssl/private/ssl-cert-snakeoil.key"
#     
#     # Error and Access Logs
#     ErrorLog ${APACHE_LOG_DIR}/ssl_error.log
#     CustomLog ${APACHE_LOG_DIR}/ssl_access.log combined
#     
#     # SSL Protocol and Cipher Configuration
#     SSLProtocol -all +TLSv1.2 +TLSv1.3
#     SSLCipherSuite HIGH:!aNULL:!MD5
#     SSLHonorCipherOrder on
#     
#     # Directory Configuration
#     <Directory "/var/www/html/public">
#         Options -Indexes +FollowSymLinks
#         AllowOverride All
#         Require all granted
#         
#         RewriteEngine On
#         RewriteCond %{REQUEST_FILENAME} !-f
#         RewriteCond %{REQUEST_FILENAME} !-d
#         RewriteRule ^(.*)$ router.php [QSA,L]
#     </Directory>
# </VirtualHost>
